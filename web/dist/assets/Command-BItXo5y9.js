import{r as d,f as oe,i as se,h as ae,A as de,z as W,m as le,D as ce,j as r,y as ue,b7 as pe}from"./index-vyLcd-Je.js";import{d as me}from"./Send-u5HxT_Xo.js";import{O as P,a as z,S as w}from"./OmsMenuItem-dCh26iEY.js";import{b as he,u as fe}from"./url-3gxhyDQ6.js";import{x as ve,a as xe}from"./xterm-addon-fit-Kh6Ly0p6.js";import{l as Z}from"./lodash-n0fAs3Cp.js";import{b as B}from"./Select-SR092O4V.js";import{A as ge,T as Le}from"./TextField-WpV9j2Nf.js";import{T as H}from"./Tooltip-uuOg3L5G.js";import{I as Y}from"./Portal-fdJRnxBE.js";import{B as ye}from"./Modal-WZGSkPqe.js";import"./ExpandMore-3kkaHWRN.js";import"./MenuItem-XkAApCKL.js";import"./useTheme-gj9g8ZO4.js";import"./Grow-AEneWTZ1.js";import"./createSvgIcon-Wj1pg0ep.js";import"./useControlled-AZyJHjwc.js";import"./ButtonBase-JuvOKhC4.js";import"./useIsFocusVisible-4p8xcV5K.js";var F={},_e=se,ke=ae;Object.defineProperty(F,"__esModule",{value:!0});var U=F.default=void 0,be=ke(d),Ce=_e(oe()),Se=(0,Ce.default)(be.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");U=F.default=Se;var V={exports:{}};(function(l,j){(function(I,h){l.exports=h()})(self,function(){return(()=>{var I={6:(f,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.LinkComputer=c.WebLinkProvider=void 0;var v=function(){function u(n,i,t,o){o===void 0&&(o={}),this._terminal=n,this._regex=i,this._handler=t,this._options=o}return u.prototype.provideLinks=function(n,i){var t=T.computeLink(n,this._regex,this._terminal,this._handler);i(this._addCallbacks(t))},u.prototype._addCallbacks=function(n){var i=this;return n.map(function(t){return t.leave=i._options.leave,t.hover=function(o,a){if(i._options.hover){var L=t.range;i._options.hover(o,a,L)}},t})},u}();c.WebLinkProvider=v;var T=function(){function u(){}return u.computeLink=function(n,i,t,o){for(var a,L=new RegExp(i.source,(i.flags||"")+"g"),p=u._translateBufferLineToStringWithWrap(n-1,!1,t),x=p[0],C=p[1],k=-1,O=[];(a=L.exec(x))!==null;){var S=a[1];if(!S){console.log("match found without corresponding matchIndex");break}if(k=x.indexOf(S,k+1),L.lastIndex=k+S.length,k<0)break;for(var b=k+S.length,A=C+1;b>t.cols;)b-=t.cols,A++;for(var y=k+1,N=C+1;y>t.cols;)y-=t.cols,N++;var R={start:{x:y,y:N},end:{x:b,y:A}};O.push({range:R,text:S,activate:o})}return O},u._translateBufferLineToStringWithWrap=function(n,i,t){var o,a,L="";do{if(!(x=t.buffer.active.getLine(n)))break;x.isWrapped&&n--,a=x.isWrapped}while(a);var p=n;do{var x,C=t.buffer.active.getLine(n+1);if(o=!!C&&C.isWrapped,!(x=t.buffer.active.getLine(n)))break;L+=x.translateToString(!o&&i).substring(0,t.cols),n++}while(o);return[L,p]},u}();c.LinkComputer=T}},h={};function E(f){var c=h[f];if(c!==void 0)return c.exports;var v=h[f]={exports:{}};return I[f](v,v.exports,E),v.exports}var $={};return(()=>{var f=$;Object.defineProperty(f,"__esModule",{value:!0}),f.WebLinksAddon=void 0;var c=E(6),v=new RegExp(`(?:^|[^\\da-z\\.-]+)((https?:\\/\\/)((([\\da-z\\.-]+)\\.([a-z\\.]{2,18}))|((\\d{1,3}\\.){3}\\d{1,3})|(localhost))(:\\d{1,5})?((\\/[\\/\\w\\.\\-%~:+@]*)*([^:"'\\s]))?(\\?[0-9\\w\\[\\]\\(\\)\\/\\?\\!#@$%&'*+,:;~\\=\\.\\-]*)?(#[0-9\\w\\[\\]\\(\\)\\/\\?\\!#@$%&'*+,:;~\\=\\.\\-]*)?)($|[^\\/\\w\\.\\-%]+)`);function T(n,i){var t=window.open();if(t){try{t.opener=null}catch{}t.location.href=i}else console.warn("Opening link blocked as opener could not be cleared")}var u=function(){function n(i,t,o){i===void 0&&(i=T),t===void 0&&(t={}),o===void 0&&(o=!1),this._handler=i,this._options=t,this._useLinkProvider=o}return n.prototype.activate=function(i){if(this._terminal=i,this._useLinkProvider&&"registerLinkProvider"in this._terminal){var t=(o=this._options).urlRegex||v;this._linkProvider=this._terminal.registerLinkProvider(new c.WebLinkProvider(this._terminal,t,this._handler,o))}else{var o;(o=this._options).matchIndex=1,this._linkMatcherId=this._terminal.registerLinkMatcher(v,this._handler,o)}},n.prototype.dispose=function(){var i;this._linkMatcherId!==void 0&&this._terminal!==void 0&&this._terminal.deregisterLinkMatcher(this._linkMatcherId),(i=this._linkProvider)===null||i===void 0||i.dispose()},n}();f.WebLinksAddon=u})(),$})()})})(V);var we=V.exports;const je="\x1B[1;3;31m",Ie="\x1B[1;33m",Ee="\x1B[1;3;36m",J="\x1B[1;3;0m",Te=(l,j,I)=>{const h=d.useRef();return h.current||(h.current=Z.debounce(l,j,I)),h.current},Oe=(l,j)=>({...j,hostList:l.hostList,groupList:l.groupList,tagList:l.tagList,playerList:l.playerList,quickCommandList:l.quickCommandList}),Re={updateGroupList:W.updateGroupList,updateTagList:W.updateTagList,updateHostList:W.getHostList,updatePlayerList:W.initPlayerInfo,initQuickCommandAction:W.initQuickCommandList},We=le(l=>ue({root:{width:"98%",height:"100%"},ControlBox:{width:"100%",display:"flex",alignContent:"center",alignItems:"flex-end",justifyContent:"space-between"},Control:{width:"20%"},shellBox:{marginTop:"20px",width:"100%",overflow:"auto"}})),$e={hostList:"请选择主机",groupList:"请选择分组",tagList:"请选择标签",default:"请先选择类型"};let M={rows:30,cols:120};const Ae=l=>{const{hostList:j,groupList:I,tagList:h,playerList:E,updateHostList:$,updateTagList:f,updateGroupList:c,updatePlayerList:v,initQuickCommandAction:T,quickCommandList:u}=l,{enqueueSnackbar:n}=ce(),i=We(),[t,o]=d.useState(""),[a,L]=d.useState(""),[p,x]=d.useState(""),[C,k]=d.useState([]),[O,S]=d.useState("cmd"),[b,A]=d.useState(0),[y,N]=d.useState(null),[R,K]=d.useState(null);d.useEffect(()=>{$(),f(),c(),v(),T()},[]);const X=Te(e=>{console.log(e),(async()=>{var D;console.log("cmd",e);const _=await pe(e);((D=_==null?void 0:_.data)==null?void 0:D.length)>0&&k(_.data)})()},300);d.useEffect(()=>{try{if(!p)return;X(p)}catch(e){n(`获取cmd历史数据失败: ${JSON.stringify(e)}`,{autoHideDuration:2e3,variant:"error"})}},[p]),d.useEffect(()=>{const e=new WebSocket(`${he}${fe.index}`),s=new ve.Terminal({...M}),_=new xe.FitAddon;s.loadAddon(new we.WebLinksAddon),s.loadAddon(_),K(s),N(e),s.open(document.getElementById("commandTerminal")),s.focus(),_.fit(),e.onopen=m=>{e.send(JSON.stringify({type:"RESIZE",data:M}))},e.onmessage=m=>{const{data:g,type:ie,msg:G,code:ne}=JSON.parse(m.data);if(ne==="-1"){s==null||s.writeln(`${je}ERROR: ${G}${J}`);return}ie==="msg"?s==null||s.writeln(`${Ee}${G}${J}`):(s==null||s.writeln(`${Ie}(${g==null?void 0:g.seq} ${g==null?void 0:g.hostname} ${g==null?void 0:g.addr})${J}`),s==null||s.writeln(g.msg))},e.onerror=m=>{n(` WebSocket服务器连接失败: ${m.type}`,{autoHideDuration:2e3,variant:"error"})};const D=setTimeout(()=>{_.fit()},100);s.onResize(m=>{y==null||y.send(JSON.stringify({type:"RESIZE",data:{cols:m.cols,rows:m.rows}})),M={cols:m.cols,rows:m.rows}});const Q=Z.debounce(()=>{const m=Math.ceil(document.body.clientHeight/18-10);s.resize(M.cols,m),_.fit()},300);return window.addEventListener("resize",Q),()=>{e.close(),clearTimeout(D),s.dispose(),window.removeEventListener("resize",Q)}},[]);const ee=()=>{if(!t||!a){n("请先选择所有选项",{autoHideDuration:2e3,variant:"error"});return}if(!t||!a){n("请先选择所有选项",{autoHideDuration:2e3,variant:"error"});return}y.send(JSON.stringify({type:"WS_CMD",data:{type:t,id:a,cmd:p,cmd_type:O,cmd_id:b}}))},te=e=>{if(!t&&!a&&(!p||!b)){n("请先选择执行对象",{autoHideDuration:2e3,variant:"error"});return}y.send(JSON.stringify({type:"WS_CMD",data:{type:t,id:a,cmd:e.cmd,cmd_type:"cmd",cmd_id:b}}))},q=e=>t==="host"?e?j:"hostList":t==="group"?e?I:"groupList":t==="tag"?e?h:"tagList":e?[]:"default",re=e=>{L(e.target.value)};return r.jsxs("div",{className:i.root,children:[r.jsxs("div",{className:i.ControlBox,children:[r.jsxs(B,{className:i.Control,style:{width:"120px"},children:[r.jsx(P,{children:"请选择类型"}),r.jsxs(z,{id:"type-select",value:t,onChange:e=>o(e.target.value),children:[r.jsx(w,{value:"host",children:"主机"}),r.jsx(w,{value:"group",children:"组"}),r.jsx(w,{value:"tag",children:"标签"})]})]}),r.jsxs(B,{className:i.Control,children:[r.jsx(P,{children:$e[q(!1)]}),r.jsx(z,{disabled:!t,labelId:"typeItem-select-label",id:"typeItem-select-label",value:a,onChange:re,children:q(!0).length>0?q(!0).map(e=>r.jsx(w,{value:e.id,children:`${e.name} ${"addr"in e&&(e!=null&&e.addr)?e.addr:""}`},e.name)):null})]}),r.jsxs(B,{className:i.Control,style:{width:"100px"},children:[r.jsx(P,{children:"命令类型"}),r.jsxs(z,{id:"type-select-cmd-type",value:O,onChange:e=>S(e.target.value),children:[r.jsx(w,{value:"cmd",children:"cmd"}),r.jsx(w,{value:"player",children:"剧本"})]})]}),O==="cmd"?r.jsx(ge,{freeSolo:!0,inputValue:p,onInputChange:(e,s)=>{x(s)},id:"cmd-disabled",options:C,sx:{width:300},renderInput:e=>r.jsx(Le,{...e,size:"small",label:"请输入执行的命令"})}):r.jsxs(B,{className:i.Control,children:[r.jsx(P,{children:"选择剧本"}),r.jsx(z,{id:"type-select-player-id",value:b,onChange:e=>A(e.target.value),children:E==null?void 0:E.map(e=>r.jsx(w,{value:e.id,children:e.name},e.id))})]}),r.jsxs("div",{children:[r.jsx(H,{title:"下发命令",placement:"top-start",children:r.jsx(Y,{color:"primary","aria-label":"send",onClick:ee,children:r.jsx(me,{fontSize:"large"})})}),r.jsx(H,{title:"清屏",placement:"top-start",children:r.jsx(Y,{"aria-label":"clear",onClick:()=>{R==null||R.clear()},children:r.jsx(U,{fontSize:"large",color:"error"})})})]})]}),r.jsx("div",{className:i.shellBox,children:r.jsx("div",{id:"commandTerminal"})}),r.jsx("div",{style:{width:"100%"},children:u.map(e=>r.jsx(H,{title:`发送快捷命令: ${e.cmd}`,placement:"top-start",children:r.jsx(ye,{variant:"outlined",size:"small",style:{padding:"0, 2px",height:"20px",textTransform:"none"},onClick:()=>{te(e)},children:e.name})},e.id))})]})},tt=de(Oe,Re)(Ae);export{tt as default};
