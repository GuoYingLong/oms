import{m as N,j as e,D,r,a7 as I,a8 as O,A as _,z as y,L as q,a9 as L}from"./index-vyLcd-Je.js";import{T as G,F as J}from"./FormDialog-4Nls6tjn.js";import{s as K}from"./style-oIRJWkRv.js";import{T as g}from"./TextField-ExYO2cNO.js";import{B as x}from"./Button-P3xriBeC.js";import{P as M}from"./Grow-AEneWTZ1.js";import{T as Q,a as U,b as V,c as T,d as k,e as X,f as Y}from"./TableRow-MEti22uE.js";import{b as S}from"./Select-SR092O4V.js";import"./DialogActions-TfqgKDOq.js";import"./useTheme-gj9g8ZO4.js";import"./KeyboardArrowRight-okvb3hby.js";import"./MenuItem-XkAApCKL.js";const Z=({Info:i,setInfo:t,fileName:m,setFileName:o})=>{const c=N(K)();return e.jsxs(e.Fragment,{children:[e.jsx(g,{autoFocus:!0,margin:"dense",id:"tag-name",label:"密钥名称",fullWidth:!0,value:i.name,onChange:n=>t({...i,name:n.target.value})}),e.jsx(g,{autoFocus:!0,margin:"dense",id:"tag-name",label:"密钥的密码",fullWidth:!0,value:i.passphrase,onChange:n=>t({...i,passphrase:n.target.value})}),e.jsxs("div",{className:c.keyFile,children:[e.jsx(g,{size:"small",disabled:!0,id:"select-file",variant:"outlined",value:m}),e.jsx("input",{className:c.input,id:"contained-button-file",multiple:!0,type:"file",onChange:n=>{var u,d,p;n.target.files[0].name&&(t({...i,key_file:(u=n.target)==null?void 0:u.files[0]}),o((p=(d=n.target)==null?void 0:d.files[0])==null?void 0:p.name))}}),e.jsx("label",{htmlFor:"contained-button-file",children:e.jsx(x,{variant:"contained",color:"primary",component:"span",children:"选择秘钥文件"})})]})]})},ee=[{id:"name",label:"密钥名称",minWidth:170},{id:"operation",label:"操作",minWidth:170}];function ae({deletePrivateKey:i,privateKeyList:t,editPrivateKey:m}){const o=N(K)(),{enqueueSnackbar:c}=D(),[n,u]=r.useState(0),[d,p]=r.useState(10),[j,f]=r.useState(!1),[b,s]=r.useState(!1),[h,v]=r.useState("未选择任何文件"),[l,P]=r.useState({id:0,name:"",passphrase:"",key_file:""}),$=Z({Info:l,setInfo:P,fileName:h,setFileName:v}),w="确定要删除这个密钥文件吗？",B="如果不想删除可以点击取消",H=a=>{P(a),f(!0)},R=()=>{f(!1)},E=r.useCallback(async()=>{const a=await I(l);if(v("未选择任何文件"),a.code!=="200"){c(`密钥: ${l.name}修改失败${a.msg}`,{autoHideDuration:3e3,variant:"error"});return}return m(a.data),c(`密钥: ${l.name} 修改成功${a.msg}`,{autoHideDuration:3e3,variant:"success"}),!0},[l]),W=r.useCallback(async()=>{const a=await O(l.id);if(a.code!=="200"){c(`密钥: ${l.name}删除失败${a.msg}`,{autoHideDuration:3e3,variant:"error"});return}i(l.id),c(`密钥: ${l.name} 已被删除`,{autoHideDuration:3e3,variant:"success"})},[l]),z=(a,C)=>{u(C)},A=a=>{p(+a.target.value),u(0)};return e.jsxs(M,{className:o.rootTable,children:[e.jsx(Q,{className:o.container,children:e.jsxs(U,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(V,{children:e.jsx(T,{children:ee.map(a=>e.jsx(k,{align:"center",style:{minWidth:a.minWidth},children:a.label},a.id))})}),e.jsx(X,{children:t&&t.slice(n*d,n*d+d).map(a=>e.jsxs(T,{hover:!0,role:"checkbox",tabIndex:-1,children:[e.jsx(k,{align:"center",children:a.name},a.name),e.jsxs(k,{align:"center",children:[e.jsx(x,{className:o.editBtn,onClick:()=>{P(a),s(!0)},children:"编辑"}),e.jsx(x,{className:o.deleteButton,onClick:()=>H(a),children:"删除"})]})]},a.name))})]})}),e.jsx(Y,{rowsPerPageOptions:[10,25,100],component:"div",labelRowsPerPage:"每页行数:",labelDisplayedRows:({from:a,to:C,count:F})=>`${a}-${C} 总数 ${F!==-1?F:0}`,count:t.length,rowsPerPage:d,page:n,onPageChange:z,onRowsPerPageChange:A}),e.jsx(G,{open:j,title:w,text:B,toClose:R,todo:W}),e.jsx(J,{open:b,content:$,toClose:()=>s(!1),title:"编辑密钥信息",todo:E})]})}const te=(i,t)=>({...t,privateKeyList:i.privateKeyList}),se={toInit:y.initPrivateKeyInfo,deletePrivateKey:y.deletePrivateKeyInfo,addPrivateKey:y.addPrivateKeyInfo,editPrivateKey:y.editPrivateKeyInfo},ne=i=>{const t=N(K)(),{enqueueSnackbar:m}=D(),[o,c]=r.useState(""),[n,u]=r.useState(""),[d,p]=r.useState("未选择文件"),[j,f]=r.useState("");r.useEffect(()=>{(async()=>{const s=await q();s.code==="200"&&i.toInit(s.data)})()},[]);const b=async()=>{if(i.privateKeyList.some(h=>h.name===n)){m("密钥已存在！",{autoHideDuration:3e3,variant:"warning"});return}const s=await L({name:o,passphrase:n,key_file:j});if(s.code!=="200"){m(`密钥添加失败${s.msg}`,{autoHideDuration:3e3,variant:"error"});return}i.addPrivateKey(s.data),m(`密钥: ${s.data.name}添加成功！`,{autoHideDuration:3e3,variant:"success"})};return e.jsxs("div",{className:t.itemPage,children:[e.jsxs("div",{className:t.ControlBox,children:[e.jsx(S,{className:t.Control,children:e.jsx(g,{size:"small",id:"private-key-name",label:"密钥名称",variant:"outlined",value:o,onChange:s=>c(s.target.value)})}),e.jsx(S,{className:t.Control,children:e.jsx(g,{size:"small",id:"private-key-name",label:"密钥的密码(非必填)",variant:"outlined",placeholder:"密钥的密码可以为空",value:n,onChange:s=>u(s.target.value)})}),e.jsxs("div",{className:t.keyFile,children:[e.jsx(g,{size:"small",disabled:!0,id:"select-file",variant:"outlined",value:d}),e.jsx("input",{className:t.input,id:"contained-key-file",multiple:!0,type:"file",onChange:s=>{var h,v,l;s.target.files[0].name&&(f((h=s.target)==null?void 0:h.files[0]),p((l=(v=s.target)==null?void 0:v.files[0])==null?void 0:l.name))}}),e.jsx("label",{htmlFor:"contained-key-file",children:e.jsx(x,{variant:"contained",color:"primary",component:"span",children:"选择秘钥文件"})})]}),e.jsx(x,{className:t.addButton,onClick:b,children:"添加密钥"})]}),e.jsx("div",{className:t.shellBox,children:e.jsx(ae,{...i})})]})},xe=_(te,se)(ne);export{xe as default};
