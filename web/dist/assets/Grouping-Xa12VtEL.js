import{j as e,m as N,D as k,r as l,a1 as z,a2 as M,A as O,z as S,a3 as q}from"./index-vyLcd-Je.js";import{s as $}from"./style-oIRJWkRv.js";import{T as I,F as J}from"./FormDialog-4Nls6tjn.js";import{b as g,I as y,S as G}from"./Select-SR092O4V.js";import{M as x}from"./MenuItem-XkAApCKL.js";import{T as j}from"./TextField-ExYO2cNO.js";import{P as K}from"./Grow-AEneWTZ1.js";import{T as Q,a as U,b as V,c as T,d as p,e as X,f as Y}from"./TableRow-MEti22uE.js";import{B as f}from"./Button-P3xriBeC.js";import"./DialogActions-TfqgKDOq.js";import"./useTheme-gj9g8ZO4.js";import"./KeyboardArrowRight-okvb3hby.js";const Z=({Info:s,setInfo:n})=>e.jsxs(e.Fragment,{children:[e.jsxs(g,{style:{width:"100%"},children:[e.jsx(y,{id:"job-select-label",children:"选择模式"}),e.jsxs(G,{labelId:"job-select-label",id:"group-select",value:s.mode,onChange:t=>n({...s,mode:Number(t.target.value)}),children:[e.jsx(x,{value:0,children:"主机模式"}),e.jsx(x,{value:1,children:"规则模式"})]})]}),e.jsx(j,{autoFocus:!0,margin:"dense",id:"group-name",label:"分组名称",fullWidth:!0,value:s.name,onChange:t=>n({...s,name:t.target.value})}),e.jsx(j,{autoFocus:!0,margin:"dense",id:"params",label:"匹配规则",fullWidth:!0,value:s.params,onChange:t=>n({...s,params:t.target.value})})]}),_=[{id:"name",label:"分组名称",minWidth:170},{id:"mode",label:"模式",minWidth:170},{id:"params",label:"规则",minWidth:170},{id:"density",label:"操作",minWidth:170}];function ee({groupList:s,updateGroupList:n}){const t=N($)(),{enqueueSnackbar:o}=k(),[m,c]=l.useState(0),[d,u]=l.useState(10),[b,h]=l.useState(!1),[v,r]=l.useState(!1),[i,C]=l.useState({id:0,name:"",mode:0,params:""}),H=Z({Info:i,setInfo:C}),w=l.useCallback(async()=>{const a=await z(i);if(a.code!=="200"){o(`分组: ${i.name}修改失败${a.msg}`,{autoHideDuration:3e3,variant:"error"});return}return n(),o(`分组: ${i.name} 修改成功${a.msg}`,{autoHideDuration:3e3,variant:"success"}),!0},[i]),B="确定要删除这个分组吗？",F="如果不想删除可以点击取消",W=a=>{C(a),h(!0)},R=()=>{h(!1)},E=l.useCallback(async()=>{const a=await M(i.id);if(a.code!=="200"){o(`分组: ${i.name}删除失败${a.msg}`,{autoHideDuration:3e3,variant:"error"});return}n(),o(`分组: ${i.name} 已被删除`,{autoHideDuration:3e3,variant:"success"})},[i]),A=(a,P)=>{c(P)},L=a=>{u(+a.target.value),c(0)};return e.jsxs(K,{className:t.rootTable,children:[e.jsx(Q,{className:t.container,children:e.jsxs(U,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(V,{children:e.jsx(T,{children:_.map(a=>e.jsx(p,{align:"center",style:{minWidth:a.minWidth},children:a.label},a.id))})}),e.jsx(X,{children:s&&s.slice(m*d,m*d+d).map(a=>e.jsxs(T,{hover:!0,role:"checkbox",tabIndex:-1,children:[e.jsx(p,{align:"center",children:a.name},a.name),e.jsx(p,{align:"center",children:a.mode?"规则模式":"主机模式"},a.mode),e.jsx(p,{align:"center",children:a.params},a.params),e.jsxs(p,{align:"center",children:[e.jsx(f,{className:t.editBtn,onClick:()=>{C(a),r(!0)},children:"编辑"}),e.jsx(f,{className:t.deleteButton,onClick:()=>W(a),children:"删除"})]})]},a.name))})]})}),e.jsx(Y,{rowsPerPageOptions:[10,25,100],labelRowsPerPage:"每页行数:",labelDisplayedRows:({from:a,to:P,count:D})=>`${a}-${P} 总数 ${D!==-1?D:0}`,component:"div",count:s.length,rowsPerPage:d,page:m,onPageChange:A,onRowsPerPageChange:L}),e.jsx(I,{open:b,title:B,text:F,toClose:R,todo:E}),e.jsx(J,{open:v,content:H,toClose:()=>r(!1),title:"编辑分组信息",todo:w})]})}const ae=(s,n)=>({...n,groupList:s.groupList}),te={initGroup:S.initGroupInfo,updateGroupList:S.updateGroupList},se=s=>{const n=N($)(),{enqueueSnackbar:t}=k(),[o,m]=l.useState(""),[c,d]=l.useState(""),[u,b]=l.useState(""),h=r=>{m(r.target.value)},v=async()=>{if(o===""){t("请选择一个模式！",{autoHideDuration:3e3,variant:"warning"});return}if(o===1&&!c){t("选中规则模式, 匹配的规则不能为空！",{autoHideDuration:3e3,variant:"warning"});return}if(!u){t("分组名称不能为空！",{autoHideDuration:3e3,variant:"warning"});return}if(s.groupList.some(i=>i.name===u)){t("该分组已存在！",{autoHideDuration:3e3,variant:"warning"});return}const r=await q({name:u,mode:o,params:c});if(r.code!=="200"){t(`分组添加失败${r.msg}`,{autoHideDuration:3e3,variant:"error"});return}s.updateGroupList(),t(`分组: ${r.data.name}添加成功！`,{autoHideDuration:3e3,variant:"success"})};return e.jsxs("div",{className:n.itemPage,children:[e.jsxs("div",{className:n.ControlBox,children:[e.jsxs(g,{className:n.Control,children:[e.jsx(y,{id:"pattern-select-label",children:"选择模式"}),e.jsxs(G,{labelId:"pattern-select-label",id:"pattern-select",value:o,onChange:h,children:[e.jsx(x,{value:0,children:"主机模式"}),e.jsx(x,{value:1,children:"规则模式"})]})]}),e.jsx(g,{className:n.Control,children:e.jsx(j,{size:"small",id:"Matching-rules",label:"匹配规则",variant:"outlined",value:c,placeholder:"主机模式不用添加规则",onChange:r=>d(r.target.value)})}),e.jsx(g,{className:n.Control,children:e.jsx(j,{size:"small",id:"grouping",label:"分组名称",variant:"outlined",value:u,onChange:r=>b(r.target.value)})}),e.jsx(f,{className:n.addButton,onClick:v,children:"增加分组"})]}),e.jsx("div",{className:n.shellBox,children:e.jsx(ee,{...s})})]})},xe=O(ae,te)(se);export{xe as default};
