import{r as d,c as _,_ as x,$ as re,g as q,b as W,s as E,u as V,b3 as ne,j as s,d as G,e as H,i as Y,A as ae,z as O,m as ie,D as le,T as N,y as de,b4 as ce}from"./index-vyLcd-Je.js";import{U as pe}from"./UploadButton-yzcrOpeE.js";import{O as K,a as Q,S as D}from"./OmsMenuItem-dCh26iEY.js";import{r as Z}from"./createSvgIcon-REPnXX8o.js";import{L as ue}from"./SnackMessageUpLoadFileProgress-mrKZ2kvA.js";import{b as me,u as fe}from"./url-3gxhyDQ6.js";import{l as xe}from"./lodash-n0fAs3Cp.js";import{b as X}from"./Select-SR092O4V.js";import{T as he}from"./TextField-ExYO2cNO.js";import{r as ge,m as be,a as ye,B as ve}from"./ButtonBase-JuvOKhC4.js";import{P as Se,I as Ce}from"./Portal-fdJRnxBE.js";import{u as je}from"./useControlled-AZyJHjwc.js";import{T as we}from"./Tooltip-uuOg3L5G.js";import"./Button-P3xriBeC.js";import"./ExpandMore-3kkaHWRN.js";import"./MenuItem-XkAApCKL.js";import"./createSvgIcon-Wj1pg0ep.js";import"./useIsFocusVisible-4p8xcV5K.js";import"./LinearProgress-L2jHxBZR.js";import"./useTheme-gj9g8ZO4.js";import"./Box-C_Unawo1.js";import"./Card-ZBbaDw8s.js";import"./Grow-AEneWTZ1.js";const ee=d.createContext({}),Ae=["className","elementType","ownerState","externalForwardedProps","getSlotOwnerState","internalForwardedProps"],Pe=["component","slots","slotProps"],Re=["component"];function Le(e,t){const{className:n,elementType:a,ownerState:c,externalForwardedProps:h,getSlotOwnerState:p,internalForwardedProps:i}=t,u=_(t,Ae),{component:w,slots:g={[e]:void 0},slotProps:A={[e]:void 0}}=h,S=_(h,Pe),C=g[e]||a,m=ge(A[e],c),y=be(x({className:n},u,{externalForwardedProps:e==="root"?S:void 0,externalSlotProps:m})),{props:{component:b},internalRef:f}=y,L=_(y.props,Re),T=re(f,m==null?void 0:m.ref,t.ref),v=p?p(L):{},M=x({},c,v),k=e==="root"?b||w:b,P=ye(C,x({},e==="root"&&!w&&!g[e]&&i,e!=="root"&&!g[e]&&i,L,k&&{as:k},{ref:T}),M);return Object.keys(v).forEach(o=>{delete P[o]}),[C,P]}function $e(e){return W("MuiAccordion",e)}const Te=q("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),U=Te,ke=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],Ne=e=>{const{classes:t,square:n,expanded:a,disabled:c,disableGutters:h}=e;return H({root:["root",!n&&"rounded",a&&"expanded",c&&"disabled",!h&&"gutters"],region:["region"]},$e,t)},Ie=E(Se,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${U.region}`]:t.region},t.root,!n.square&&t.rounded,!n.disableGutters&&t.gutters]}})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{position:"relative",transition:e.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(e.vars||e).palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${U.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${U.disabled}`]:{backgroundColor:(e.vars||e).palette.action.disabledBackground}}},({theme:e,ownerState:t})=>x({},!t.square&&{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(e.vars||e).shape.borderRadius,borderBottomRightRadius:(e.vars||e).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}},!t.disableGutters&&{[`&.${U.expanded}`]:{margin:"16px 0"}})),_e=d.forwardRef(function(t,n){const a=V({props:t,name:"MuiAccordion"}),{children:c,className:h,defaultExpanded:p=!1,disabled:i=!1,disableGutters:u=!1,expanded:w,onChange:g,square:A=!1,slots:S={},slotProps:C={},TransitionComponent:m,TransitionProps:y}=a,b=_(a,ke),[f,L]=je({controlled:w,default:p,name:"Accordion",state:"expanded"}),T=d.useCallback(r=>{L(!f),g&&g(r,!f)},[f,g,L]),[v,...M]=d.Children.toArray(c),k=d.useMemo(()=>({expanded:f,disabled:i,disableGutters:u,toggle:T}),[f,i,u,T]),P=x({},a,{square:A,disabled:i,disableGutters:u,expanded:f}),o=Ne(P),l=x({transition:m},S),j=x({transition:y},C),[R,$]=Le("transition",{elementType:ne,externalForwardedProps:{slots:l,slotProps:j},ownerState:P});return delete $.ownerState,s.jsxs(Ie,x({className:G(o.root,h),ref:n,ownerState:P,square:A},b,{children:[s.jsx(ee.Provider,{value:k,children:v}),s.jsx(R,x({in:f,timeout:"auto"},$,{children:s.jsx("div",{"aria-labelledby":v.props.id,id:v.props["aria-controls"],role:"region",className:o.region,children:M})}))]}))}),Me=_e;function Ee(e){return W("MuiAccordionDetails",e)}q("MuiAccordionDetails",["root"]);const Be=["className"],De=e=>{const{classes:t}=e;return H({root:["root"]},Ee,t)},Ue=E("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>({padding:e.spacing(1,2,2)})),Fe=d.forwardRef(function(t,n){const a=V({props:t,name:"MuiAccordionDetails"}),{className:c}=a,h=_(a,Be),p=a,i=De(p);return s.jsx(Ue,x({className:G(i.root,c),ref:n,ownerState:p},h))}),Ge=Fe;function Oe(e){return W("MuiAccordionSummary",e)}const qe=q("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),I=qe,We=["children","className","expandIcon","focusVisibleClassName","onClick"],Ve=e=>{const{classes:t,expanded:n,disabled:a,disableGutters:c}=e;return H({root:["root",n&&"expanded",a&&"disabled",!c&&"gutters"],focusVisible:["focusVisible"],content:["content",n&&"expanded",!c&&"contentGutters"],expandIconWrapper:["expandIconWrapper",n&&"expanded"]},Oe,t)},He=E(ve,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e,ownerState:t})=>{const n={duration:e.transitions.duration.shortest};return x({display:"flex",minHeight:48,padding:e.spacing(0,2),transition:e.transitions.create(["min-height","background-color"],n),[`&.${I.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${I.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`&:hover:not(.${I.disabled})`]:{cursor:"pointer"}},!t.disableGutters&&{[`&.${I.expanded}`]:{minHeight:64}})}),ze=E("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})(({theme:e,ownerState:t})=>x({display:"flex",flexGrow:1,margin:"12px 0"},!t.disableGutters&&{transition:e.transitions.create(["margin"],{duration:e.transitions.duration.shortest}),[`&.${I.expanded}`]:{margin:"20px 0"}})),Je=E("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})(({theme:e})=>({display:"flex",color:(e.vars||e).palette.action.active,transform:"rotate(0deg)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),[`&.${I.expanded}`]:{transform:"rotate(180deg)"}})),Ke=d.forwardRef(function(t,n){const a=V({props:t,name:"MuiAccordionSummary"}),{children:c,className:h,expandIcon:p,focusVisibleClassName:i,onClick:u}=a,w=_(a,We),{disabled:g=!1,disableGutters:A,expanded:S,toggle:C}=d.useContext(ee),m=f=>{C&&C(f),u&&u(f)},y=x({},a,{expanded:S,disabled:g,disableGutters:A}),b=Ve(y);return s.jsxs(He,x({focusRipple:!1,disableRipple:!0,disabled:g,component:"div","aria-expanded":S,className:G(b.root,h),focusVisibleClassName:G(b.focusVisible,i),onClick:m,ref:n,ownerState:y},w,{children:[s.jsx(ze,{className:b.content,ownerState:y,children:c}),p&&s.jsx(Je,{className:b.expandIconWrapper,ownerState:y,children:p})]}))}),Qe=Ke;var z={},Xe=Y;Object.defineProperty(z,"__esModule",{value:!0});var oe=z.default=void 0,Ye=Xe(Z()),Ze=s;oe=z.default=(0,Ye.default)((0,Ze.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");var J={},eo=Y;Object.defineProperty(J,"__esModule",{value:!0});var te=J.default=void 0,oo=eo(Z()),to=s;te=J.default=(0,oo.default)((0,to.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel");const so=(e,t)=>({...t,hostList:e.hostList,groupList:e.groupList,tagList:e.tagList}),ro={updateGroupList:O.updateGroupList,updateTagList:O.updateTagList,updateHostList:O.getHostList},no=ie(e=>de({root:{width:"100%",height:"100%"},ControlBox:{marginBottom:"20px",width:"100%",display:"flex",alignContent:"space-evenly",alignItems:"center",justifyContent:"space-between"},Control:{width:"25%"},shellBox:{width:"100%",height:"70%"}})),ao={hostList:"请选择主机",groupList:"请选择分组",tagList:"请选择标签",default:"请选择子选项"};let F=[];const io=({hostList:e,groupList:t,tagList:n,updateHostList:a,updateTagList:c,updateGroupList:h})=>{const{enqueueSnackbar:p}=le(),i=no(),[u,w]=d.useState(""),[g,A]=d.useState(""),[S,C]=d.useState(""),[m,y]=d.useState([]),[b,f]=d.useState([]),[L,T]=d.useState(!1);d.useEffect(()=>{a(),c(),h()},[]),d.useEffect(()=>{const o=new WebSocket(`${me}${fe.index}`);return o.onopen=l=>{o.send(JSON.stringify({type:"FILE_STATUS"}))},o.onmessage=l=>{const{data:j}=JSON.parse(l.data);F.forEach((r,se)=>{j.forEach(B=>{(r==null?void 0:r.id)===(B==null?void 0:B.id)&&(F[se]=B)})});const R=xe.uniqBy([...F,...j],"id");F=R;const $=[...new Set([...b,...R.map(r=>r.dest)])];y(R),f($)},o.onerror=l=>{console.warn(l),p(` WebSocket服务器连接失败: ${l.type}`,{autoHideDuration:2e3,variant:"error"})},o.onclose=function(l){console.log("Connection closed.",l)},()=>{o.close()}},[]);const v=o=>u==="host"?o?e:"hostList":u==="group"?o?t:"groupList":u==="tag"?o?n:"tagList":o?[]:"default",M=o=>{A(o.target.value)},k=o=>(l,j)=>{T(j?o:!1)},P=async o=>{try{(await ce(o)).code==="200"&&p(`${o.addr}: ${o.file} 已取消上传`,{autoHideDuration:1e4,variant:"success"})}catch(l){p(`${o.addr}: ${o.file} 取消上传失败 ${l}`,{autoHideDuration:1e4,variant:"error"})}};return s.jsxs("div",{className:i.root,children:[s.jsxs("div",{className:i.ControlBox,children:[s.jsxs(X,{className:i.Control,children:[s.jsx(K,{children:"请选择类型"}),s.jsxs(Q,{id:"type-select",value:u,onChange:o=>w(o.target.value),children:[s.jsx(D,{value:"host",children:"主机"}),s.jsx(D,{value:"group",children:"组"}),s.jsx(D,{value:"tag",children:"标签"})]})]}),s.jsxs(X,{className:i.Control,children:[s.jsx(K,{children:ao[v(!1)]}),s.jsx(Q,{disabled:!u,labelId:"typeItem-select-label",id:"typeItem-select-label",value:g,onChange:M,children:v(!0).length>0?v(!0).map(o=>s.jsx(D,{value:o.id,children:o.name},o.name)):null})]})]}),s.jsxs("div",{className:i.ControlBox,children:[s.jsx(he,{className:i.Control,size:"small",id:"outlined-disabled",label:"请输入远程端文件存储的路径",variant:"outlined",value:S,onChange:o=>C(o.target.value)}),s.jsx(pe,{filePath:S,typeId:g,type:u})]}),s.jsx("div",{className:i.shellBox,children:b&&b.map(o=>{var l,j,R,$;return s.jsxs(Me,{expanded:L===o,onChange:k(o),children:[s.jsxs(Qe,{expandIcon:s.jsx(oe,{}),"aria-controls":`${o}content`,id:`${o}header`,children:[s.jsx(N,{sx:{width:"20%",flexShrink:0},children:o}),s.jsxs(N,{sx:{color:"text.secondary",width:"15%",flexShrink:0},children:["共",m.filter(r=>r.dest===o).length,"个文件"]}),s.jsxs(N,{sx:{width:"15%",flexShrink:0},color:"secondary",children:["上传中:",(l=m.filter(r=>r.dest===o))==null?void 0:l.filter(r=>r.status==="running").length]}),s.jsxs(N,{sx:{width:"15%",flexShrink:0},color:"primary",children:["已上传:",(j=m.filter(r=>r.dest===o))==null?void 0:j.filter(r=>r.status==="done").length]}),s.jsxs(N,{sx:{width:"15%",flexShrink:0},color:"error",children:["失败:",(R=m.filter(r=>r.dest===o))==null?void 0:R.filter(r=>r.status==="failed").length]}),s.jsxs(N,{sx:{width:"15%",flexShrink:0},style:{color:"#ffb74d"},children:["取消:",($=m.filter(r=>r.dest===o))==null?void 0:$.filter(r=>r.status==="cancel").length]})]}),s.jsx(Ge,{children:m.filter(r=>r.dest===o).map(r=>s.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[s.jsx(ue,{dest:r.dest,total:r.total,value:r.percent,file:r.file,speed:r.speed,status:r.status}),s.jsx(we,{title:"取消上传",children:s.jsx(Ce,{"aria-label":"cancel",style:{width:"50px",height:"50px"},disabled:r.status!=="running",onClick:()=>P({addr:r.dest,file:r.file}),color:"warning",children:s.jsx(te,{})})})]},r.id))})]},o)})})]})},No=ae(so,ro)(io);export{No as default};
