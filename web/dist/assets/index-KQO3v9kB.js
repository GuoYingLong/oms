import{j as e,m as N,D as H,r as o,aY as O,aZ as q,A as G,z as B,a_ as I}from"./index-vyLcd-Je.js";import{T as J,F as Y}from"./FormDialog-4Nls6tjn.js";import{T as P}from"./TextField-ExYO2cNO.js";import{b,I as f,S as w}from"./Select-SR092O4V.js";import{M as p}from"./MenuItem-XkAApCKL.js";import{P as Z}from"./Grow-AEneWTZ1.js";import{T as K,a as Q,b as U,c as D,d as c,e as V,f as X}from"./TableRow-MEti22uE.js";import{B as S}from"./Button-P3xriBeC.js";import"./DialogActions-TfqgKDOq.js";import"./useTheme-gj9g8ZO4.js";import"./KeyboardArrowRight-okvb3hby.js";const W=t=>({root:{flexGrow:1,display:"flex",height:"100%",width:"100%",indicator:{"& > span":{maxWidth:40,width:"100%",backgroundColor:"#4bce21"}}},itemPage:{width:"100%",height:"100%"},ControlBox:{marginBottom:"20px",width:"100%",display:"flex",alignContent:"space-evenly",alignItems:"center",justifyContent:"space-between"},Control:{width:"15%"},shellBox:{width:"100%",height:"90%"},TabPanel:{height:"100%",width:"100%"},tabs:{width:"240px",borderRight:`1px solid ${t.palette.divider}`},rootTable:{width:"100%",height:"100%"},container:{height:"92%"},editBtn:{marginRight:"14px",backgroundColor:t.palette.warning[t.palette.type],"&:hover":{backgroundColor:t.palette.warning.main}},deleteButton:{backgroundColor:t.palette.error[t.palette.type],"&:hover":{backgroundColor:t.palette.error.main}},addButton:{backgroundColor:t.palette.success[t.palette.type],"&:hover":{backgroundColor:t.palette.success.main}}}),L=({Info:t,hostList:r,setInfo:l})=>e.jsxs(e.Fragment,{children:[e.jsx(P,{autoFocus:!0,margin:"dense",id:"source",label:"目标地址",fullWidth:!0,value:t.source,onChange:s=>l({...t,source:s.target.value})}),e.jsx(P,{autoFocus:!0,margin:"dense",id:"destination",label:"监听地址",fullWidth:!0,value:t.destination,onChange:s=>l({...t,destination:s.target.value})}),e.jsxs(b,{style:{width:"100%"},children:[e.jsx(f,{id:"mode-select-label",children:"选择隧道模式 "}),e.jsxs(w,{labelId:"mode-select-label",id:"mode-select",value:t.mode,onChange:s=>l({...t,mode:s.target.value}),children:[e.jsx(p,{value:"local",children:"local"}),e.jsx(p,{value:"remote",children:"remote"})]})]}),e.jsxs(b,{style:{width:"100%"},children:[e.jsx(f,{id:"host_id-select-label",children:"选择主机 "}),e.jsx(w,{labelId:"host_id-select-label",id:"host_id-select",value:t.host_id,onChange:s=>l({...t,host_id:s.target.value}),children:r&&r.map(s=>e.jsx(p,{value:s.id,children:s.name},s.id))})]})]}),ee=[{id:"id",label:"主机名称",minWidth:100},{id:"mode",label:"隧道模式",minWidth:50},{id:"source",label:"目标地址",minWidth:50},{id:"destination",label:"监听地址",minWidth:50},{id:"status",label:"状态",minWidth:50},{id:"error_msg",label:"信息",minWidth:50},{id:"density",label:"操作",minWidth:100}];function te({toInit:t,tunnelList:r,hostList:l}){const s=N(W)(),{enqueueSnackbar:i}=H(),[u,h]=o.useState(0),[g,C]=o.useState(10),[k,j]=o.useState(!1),[y,m]=o.useState(!1),[d,v]=o.useState({id:0,mode:"local",source:"",destination:"",error_msg:"",status:0,host_id:0}),n=L({Info:d,setInfo:v,hostList:l}),_=o.useCallback(async()=>{const a=await O(d);if(a.code!=="200"){i(`修改失败${a.msg}`,{autoHideDuration:3e3,variant:"error"});return}return t(),i(`修改成功${a.msg}`,{autoHideDuration:3e3,variant:"success"}),!0},[d]),$="确定要删除这个隧道吗？",R="如果不想删除可以点击取消",F=a=>{v(a),j(!0)},E=()=>{j(!1)},A=o.useCallback(async()=>{const a=await q(d.id);if(a.code!=="200"){i(`隧道id: ${d.id}删除失败${a.msg}`,{autoHideDuration:3e3,variant:"error"});return}t(),i(`隧道id: ${d.id} 已被删除`,{autoHideDuration:3e3,variant:"success"})},[d]),z=(a,x)=>{h(x)},M=a=>{C(+a.target.value),h(0)};return e.jsxs(Z,{className:s.rootTable,children:[e.jsx(K,{className:s.container,children:e.jsxs(Q,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(U,{children:e.jsx(D,{children:ee.map(a=>e.jsx(c,{align:"center",style:{minWidth:a.minWidth},children:a.label},a.id))})}),e.jsx(V,{children:r&&r.slice(u*g,u*g+g).map(a=>{var x;return e.jsxs(D,{hover:!0,role:"checkbox",tabIndex:-1,children:[e.jsx(c,{align:"center",children:(x=l==null?void 0:l.find(T=>T.id===a.host_id))==null?void 0:x.name}),e.jsx(c,{align:"center",children:a.mode}),e.jsx(c,{align:"center",children:a.source}),e.jsx(c,{align:"center",children:a.destination}),e.jsx(c,{align:"center",children:String(a.status)}),e.jsx(c,{align:"center",children:a.error_msg}),e.jsxs(c,{align:"center",children:[e.jsx(S,{className:s.editBtn,onClick:()=>{v(a),m(!0)},children:"编辑"}),e.jsx(S,{className:s.deleteButton,onClick:()=>F(a),children:"删除"})]})]},a.id)})})]})}),e.jsx(X,{rowsPerPageOptions:[10,25,100],component:"div",labelRowsPerPage:"每页行数:",labelDisplayedRows:({from:a,to:x,count:T})=>`${a}-${x} 总数 ${T!==-1?T:0}`,count:r.length,rowsPerPage:g,page:u,onPageChange:z,onRowsPerPageChange:M}),e.jsx(J,{open:k,title:$,text:R,toClose:E,todo:A}),e.jsx(Y,{open:y,content:n,toClose:()=>m(!1),title:"编辑Tunnel信息",todo:_})]})}const ae=(t,r)=>({...r,tunnelList:t.tunnelList,hostList:t.hostList}),se={updateHostList:B.getHostList,toInit:B.updateTunnelList},ne=({hostList:t,tunnelList:r,toInit:l,updateHostList:s})=>{o.useEffect(()=>{s(),l()},[]);const i=N(W)(),{enqueueSnackbar:u}=H(),[h,g]=o.useState(""),[C,k]=o.useState(""),[j,y]=o.useState(""),[m,d]=o.useState(""),v=async()=>{if(h===""){u("请选择一个模式！",{autoHideDuration:3e3,variant:"warning"});return}if(!m){u("监听地址不能为空！",{autoHideDuration:3e3,variant:"warning"});return}const n=await I({mode:h,source:j,destination:m,host_id:C});if(n.code!=="200"){u(`添加任务失败${n.msg}`,{autoHideDuration:3e3,variant:"error"});return}l()};return e.jsxs("div",{className:i.itemPage,children:[e.jsxs("div",{className:i.ControlBox,children:[e.jsxs(b,{className:i.Control,children:[e.jsx(f,{id:"job-select-label",children:"选择隧道模式"}),e.jsxs(w,{labelId:"job-select-label",id:"job-select",value:h,onChange:n=>g(n.target.value),children:[e.jsx(p,{value:"local",children:"local"}),e.jsx(p,{value:"remote",children:"remote"})]})]}),e.jsxs(b,{className:i.Control,children:[e.jsx(f,{id:"hostid-select-label",children:"选择主机"}),e.jsx(w,{labelId:"hostid-select-label",id:"hostid-select-tunnel",value:C,onChange:n=>k(n.target.value),children:t.map(n=>e.jsx(p,{value:n.id,children:n.name},n.id))})]}),e.jsx(b,{className:i.Control,children:e.jsx(P,{size:"small",id:"src-tunnel",label:"源地址",variant:"outlined",value:j,onChange:n=>y(n.target.value)})}),e.jsx(b,{className:i.Control,children:e.jsx(P,{size:"small",label:"监听地址",id:"dest-tunnel",variant:"outlined",value:m,onChange:n=>d(n.target.value)})}),e.jsx(S,{className:i.addButton,onClick:v,children:"增加隧道"})]}),e.jsx("div",{className:i.shellBox,children:e.jsx(te,{toInit:l,tunnelList:r,hostList:t})})]})},be=G(ae,se)(ne);export{be as default};
